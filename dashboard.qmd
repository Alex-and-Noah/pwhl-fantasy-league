```{r imports}
library(tidyverse)
library(gt)
library(bslib)
library(shiny)
library(bsicons)
library(ggimage)
library(rsvg)

invisible(
  lapply(
    list.files(
      "./R",
      full.names = TRUE
    ),
    source
  )
)

pool <- 30
```

```{r "Get season dates and type"}
current_date = today()
current_date = "2025-11-17"

seasons_dates_and_types <- get_seasons_dates_and_types()

season_dates_and_types <- seasons_dates_and_types["season_dates_and_types"][[1]]
season_schedules_by_id <- seasons_dates_and_types["season_schedules_by_id"][[1]]
season_schedules_by_year <- seasons_dates_and_types["season_schedules_by_year"][[1]]

days_for_current_date <- get_days_for_current_date(
  current_date,
  season_dates_and_types
)

next_game_day_date <- days_for_current_date$next_game_day_date |>
  as.character()
season_id <- days_for_current_date$season_id |>
  as.numeric()
season_yr <- days_for_current_date$season_yr |>
  as.numeric()
game_type <- days_for_current_date$game_type |>
  as.character()
```

```{r "Get team and schedule data"}
team_data_frames <- get_all_teams(
  season_id,
  season_yr,
  game_type
)

team_logo_urls <- team_data_frames["team_logo_urls"][[1]]
teams <- team_data_frames["teams"][[1]]
team_codes <- team_data_frames["team_codes"][[1]]
all_teams <- team_data_frames["all_teams"][[1]]

schedules <- get_schedule(
  season_id,
  team_codes,
  team_logo_urls,
  season_dates_and_type,
  last_game_day_date,
  next_game_day_date,
  current_date
)

schedule <- schedules["schedule"][[1]] |>
    mutate(
        game_date = game_date |> as.Date()
    )

schedule_to_date <- schedules["schedule_to_date"][[1]]
last_game_day_date <- schedules["last_game_day_date"][[1]]
next_game_day_date <- schedules["next_game_day_date"][[1]]
last_game_day <- schedules["last_game_day"][[1]]
todays_games <- schedules["todays_games"][[1]]
next_game_day <- schedules["next_game_day"][[1]]
```

```{r "Get Fantasy teams and standings"}
fantasy_teams_and_standings <- get_fantasy_teams_and_standings(
  all_teams,
  schedule_to_date,
  schedule
)

team_images <- fantasy_teams_and_standings["team_images"][[1]]
team_colours <- fantasy_teams_and_standings["team_colours"][[1]]
team_rosters <- fantasy_teams_and_standings["team_rosters"][[1]]
roster_points_per_game <- fantasy_teams_and_standings[
  "roster_points_per_game"
][[1]]
fantasy_roster_points <- fantasy_teams_and_standings[
  "fantasy_roster_points"
][[1]]

standings <- fantasy_teams_and_standings["standings"][[1]] |>
  mutate(
    Team = case_when(
      is.na(Team) ~ "logo.svg",
      .default = Team
    )
  )

standings <- standings |>
    merge(data.frame(Name = names(team_colours), Colours = team_colours)
)
```

```{r "Get preseason Fantasy teams and standings"}
schedules_preseason <- get_schedule(
  7,
  team_codes,
  team_logo_urls,
  season_dates_and_type,
  last_game_day_date,
  next_game_day_date,
  "2025-11-17"
)

schedule_preseason <- schedules["schedule"][[1]] |>
    mutate(
        game_date = game_date |> as.Date()
    )

schedule_to_date_preseason <- schedules["schedule_to_date"][[1]]
last_game_day_date <- schedules["last_game_day_date"][[1]]
next_game_day_date_preseason <- schedules["next_game_day_date"][[1]]
last_game_day_preseason <- schedules["last_game_day"][[1]]
todays_games_preseason <- schedules["todays_games"][[1]]
next_game_day_preseason <- schedules["next_game_day"][[1]]

fantasy_teams_and_standings <- get_fantasy_teams_and_standings(
  all_teams,
  schedule_to_date,
  schedule
)

team_images <- fantasy_teams_and_standings["team_images"][[1]]
team_colours <- fantasy_teams_and_standings["team_colours"][[1]]
team_rosters_preseason <- fantasy_teams_and_standings["team_rosters"][[1]]
roster_points_per_game_preseason <- fantasy_teams_and_standings[
  "roster_points_per_game"
][[1]]
fantasy_roster_points_preseason <- fantasy_teams_and_standings[
  "fantasy_roster_points"
][[1]]

standings_preseason <- fantasy_teams_and_standings["standings"][[1]] |>
  mutate(
    Team = case_when(
      is.na(Team) ~ "logo.svg",
      .default = Team
    )
  )

standings_preseason <- standings_preseason |>
    merge(data.frame(Name = names(team_colours), Colours = team_colours)
)
```

# Overview

## Row

```{r "todays games"}
if (
  nrow(
    todays_games
  ) ==
    0
) {
  value_box(
    title = "No data available",
    showcase = bs_icon(
      "hourglass-split",
      size = "6vh"
    ),
    value = tags$p(
      "No games today :(",
      style = "font-size: 4vh;"
    ),
    theme = "danger"
  )
} else {
  todays_games |>
    mutate(
      temp = "-"
    ) |>
    select(
      c(
        "away_team_code",
        "away_team_logo",
        "away_score",
        "game_status",
        "home_score",
        "home_team_logo",
        "home_team_code"
      )
    ) |>
    gt() |>
    cols_align(
      align = "center",
      columns = everything()
    ) |>
    tab_style(
      style = cell_text(weight = "bold"),
      locations = cells_body(
        columns = game_status
      )
    ) |>
    tab_header(
      format(
        current_date,
        "Today's games (%B %e, %Y)"
      )
    ) |>
    text_transform(
      locations = cells_body(
        columns = c(
          "away_team_logo",
          "home_team_logo"
        )
      ),
      fn = function(x) {
        web_image(
          url = x,
          height = "5vh"
        )
      }
    ) |>
    cols_label(
      away_team_code = "",
      away_team_logo = "Away",
      away_score = "",
      game_status = "",
      home_score = "",
      home_team_logo = "Home",
      home_team_code = ""
    ) |>
    tab_options(
    table.background.color = "#F5F5F5",
    column_labels.background.color = "#2B2D42",
    table.font.size = px(16),
    table.border.top.color = "transparent",
    table.border.bottom.color = "transparent",
    table_body.hlines.color = "transparent",
    table_body.border.bottom.color = "transparent",
    column_labels.border.bottom.color = "transparent",
    column_labels.border.top.color = "transparent"
  ) |> 
  tab_style_body(
    style = cell_borders(
      sides = c("top", "right", "left", "bottom"),
      weight = px(0) # Remove row borders
    ),
    fn = function(x) { is.numeric(x) | is.character(x) }
  ) |> 
  opt_css(
    css = "

    table tr:nth-child(odd) {
      background-color: #e0dedeff;
    }

    .gt_col_heading {
      position: sticky !important;
      top: 0px !important;
      z-index: 10 !important;
    }
    "
  )
}

```

## Row

```{r "standings overview"}
#| title: "Standings (with today's changes)"

if (
  nrow(
    todays_games
  ) != 0
) {
  delta_points <- get_fantasy_teams_and_standings(
    all_teams=all_teams,
    schedule_to_date=todays_games,
    schedule=schedule
  )["standings"][[1]]

  delta_points <- delta_points[
    match(
      standings$Name,
      delta_points$Name
    ),
  ]
} else {
  delta_points <- data.frame(
    Name = standings$Name,
    Points = rep(0, nrow(standings))
  )
}


standings|>
  mutate(
    delta = delta_points$Points
  ) |>
  arrange(
    desc(
      Points
    )
  ) |>
  mutate(
    Points = paste0(
      Points,
      " (+",
      delta,
      ")"
    )
  ) |>
  select(
    c(
      Name,
      Team,
      Points,
      Colours
    )
  ) |>
  gt() |>
  text_transform(
    locations = cells_body(
      columns = Team
    ),
    fn = function(x) {
      web_image(
        url = x,
        height = "5vh"
      )
    }
  ) |>
   tab_style(
    style = list(
      cell_fill(color =  from_column(column = "Colours")),
      cell_text(weight = "bold")
      ),
    locations = cells_body(
      columns = Team
    )
  ) |>
  cols_hide(Colours) |>
  cols_align(
    columns = everything(),
    align = "center"
  ) |>
    tab_options(
    table.background.color = "#F5F5F5",
    column_labels.background.color = "#2B2D42",
    table.font.size = px(16),
    table.border.top.color = "transparent",
    table.border.bottom.color = "transparent",
    table_body.hlines.color = "transparent",
    table_body.border.bottom.color = "transparent",
    column_labels.border.bottom.color = "transparent",
    column_labels.border.top.color = "transparent"
  ) |> 
  tab_style_body(
    style = cell_borders(
      sides = c("top", "right", "left", "bottom"),
      weight = px(0) # Remove row borders
    ),
    fn = function(x) { is.numeric(x) | is.character(x) }
  ) |> 
  opt_css(
    css = "

    table tr:nth-child(odd) {
      background-color: #e0dedeff;
    }

    .gt_col_heading {
      position: sticky !important;
      top: 0px !important;
      z-index: 10 !important;
    }
    "
  )
```

## Row

```{r "next game day"}
p_args <- next_game_day |>
  mutate(
    temp = paste0(
      home_team_code,
      " @ ",
      away_team_code,
      ", ",
      game_status
    )
  ) |>
  select(
    temp
  )

p_args <- map(
  p_args[, 1],
  p
)

value_box(
  title = "Next game day",
  showcase = bs_icon(
    "calendar-event",
    size = "6vh"
  ),
  value = tags$p(
    format(
      as.Date(
        next_game_day_date,
        format = "%Y-%m-%d"
      ),
      "%b %e, %Y"
    ),
    style = "font-size: 4vh;"
  ),
  theme = "success",
  !!!p_args
)
```

## Row

```{r "prize pool thermometer"}

temps <- data.table(temp = seq(from = 0, to = pool, by = 0.01))
temps[, temp1 := shift(temp, 1)]

ggplot(temps, aes(x = 1)) +
    geom_segment(
      aes(y = 0, yend = 10*length(team_rosters)),
      linewidth = 10,
      lineend = c("round"),
      color = "black"
    ) +
    geom_segment(
      aes(y = 0, yend = 10*length(team_rosters)),
      linewidth = 9,
      lineend = c("round"),
      color = "white"
    ) +
    geom_segment(
      data = temps[1:1000],
      aes(y = temp, yend = temp1), color = "#5F259F",
      lineend = c("round"),
      linewidth = 9
    ) +
    geom_segment(
      data = temps[-(1:1000)],
      aes(y = temp, yend = temp1), color = "#5F259F",
      lineend = c("square"),
      linewidth = 9
    ) +
    theme_void() +
    labs(
      title = paste0("Prize pool: ", pool, "$")
    ) +
    theme(
      plot.title = element_text(size = 50, hjust = 0.5)
    ) +
    coord_flip()

```

## Row

Need help making your team? Generate a random regulation team [here](#team-generator) to paste into the [Google Sheet](https://docs.google.com/spreadsheets/d/1sywjZ6quCmbLBq_wEEXZEDzcW0NeBpCtRaT3W1hDkhI/edit?usp=sharing)

## Row

```{r "Text: last update (data)"}
#| content: valuebox
#| title: "Last updated"
list(
  icon = "clock-history",
  value = format(
    now(tzone = "America/New_York"),
    "%b. %d, '%y, %H:%M"
  )
)
```

# Team Standings

## Row {.tabset}

```{r "standings full"}
#| title: "Regular season"
standings |>
  arrange(
    desc(
      Points
    )
  ) |>
  gt() |>
  text_transform(
    locations = cells_body(
      columns = Team
    ),
    fn = function(x) {
      web_image(
        url = x,
        height = "5vh"
      )
    }
  ) |>
   tab_style(
    style = list(
      cell_fill(color = from_column(column = "Colours")),
      cell_text(weight = "bold")
      ),
    locations = cells_body(
      columns = Team
    )
  ) |>
  cols_hide(Colours) |>
  cols_align(
    columns = everything(),
    align = "center"
  ) |>
    tab_options(
    table.background.color = "#F5F5F5",
    column_labels.background.color = "#2B2D42",
    table.font.size = px(16),
    table.border.top.color = "transparent",
    table.border.bottom.color = "transparent",
    table_body.hlines.color = "transparent",
    table_body.border.bottom.color = "transparent",
    column_labels.border.bottom.color = "transparent",
    column_labels.border.top.color = "transparent"
  ) |> 
  tab_style_body(
    style = cell_borders(
      sides = c("top", "right", "left", "bottom"),
      weight = px(0) # Remove row borders
    ),
    fn = function(x) { is.numeric(x) | is.character(x) }
  ) |> 
  opt_css(
    css = "

    table tr:nth-child(odd) {
      background-color: #e0dedeff;
    }

    .gt_col_heading {
      position: sticky !important;
      top: 0px !important;
      z-index: 10 !important;
    }
    "
  )
```

```{r "standings full preseason"}
#| title: "Pre-season"
standings_preseason |>
  arrange(
    desc(
      Points
    )
  ) |>
  gt() |>
  text_transform(
    locations = cells_body(
      columns = Team
    ),
    fn = function(x) {
      web_image(
        url = x,
        height = "5vh"
      )
    }
  ) |>
   tab_style(
    style = list(
      cell_fill(color = from_column(column = "Colours")),
      cell_text(weight = "bold")
      ),
    locations = cells_body(
      columns = Team
    )
  ) |>
  cols_hide(Colours) |>
  cols_align(
    columns = everything(),
    align = "center"
  ) |>
    tab_options(
    table.background.color = "#F5F5F5",
    column_labels.background.color = "#2B2D42",
    table.font.size = px(16),
    table.border.top.color = "transparent",
    table.border.bottom.color = "transparent",
    table_body.hlines.color = "transparent",
    table_body.border.bottom.color = "transparent",
    column_labels.border.bottom.color = "transparent",
    column_labels.border.top.color = "transparent"
  ) |> 
  tab_style_body(
    style = cell_borders(
      sides = c("top", "right", "left", "bottom"),
      weight = px(0) # Remove row borders
    ),
    fn = function(x) { is.numeric(x) | is.character(x) }
  ) |> 
  opt_css(
    css = "

    table tr:nth-child(odd) {
      background-color: #e0dedeff;
    }

    .gt_col_heading {
      position: sticky !important;
      top: 0px !important;
      z-index: 10 !important;
    }
    "
  )
```

## Row {.tabset}

```{r "standings over time"}
#| title: "Regular season"

if (
  schedule_to_date |>
  filter(
    game_status %in% c(
      "Final",
      "Final OT"
    )
  ) |>
  nrow() ==
    0
) {
  value_box(
    title = "No data available",
    showcase = bs_icon(
      "hourglass-split",
      size = "6vh"
    ),
    value = tags$p(
      "No games played yet this season",
      style = "font-size: 4vh;"
    ),
    theme = "danger"
  )
} else {

  data <- roster_points_per_game |> lapply(
    function(x) x |> mutate(
      earliest_game_id = schedule_to_date$game_id[1]
    ) |>
    expand(
      game_id = as.numeric(schedule_to_date$game_id),
      earliest_game_id
    ) |> select(
      -earliest_game_id
    ) %>% left_join(
      x,
      by = c(
        "game_id"
      )
    ) |> mutate(
      goals = ifelse(
        is.na(goals),
        0,
        goals
      ),
      assists = ifelse(
        is.na(assists),
        0,
        assists
      ),
      wins = ifelse(
        is.na(wins),
        0,
        wins
      ),
      ot_losses = ifelse(
        is.na(ot_losses),
        0,
        ot_losses
      ),
      wins = 2*wins,
    ) %>%
    mutate(
      fantasy_points = rowSums(
        select(
          .,
          c(
            goals,
            assists,
            wins,
            ot_losses
          )
        )
      )
    ) |>
    arrange(
      game_id
    ) |> select(
      c(
        game_id,
        fantasy_points
      )
    ) |> group_by(
      game_id
    ) |> summarise(
      daily_scores = sum(fantasy_points)
    ) |>
    mutate(
      daily_scores = cumsum(daily_scores),
      game_id = row_number()
    )
  ) |> bind_rows(
    .id = "Team"
  ) |>
  rename(
    "Game" = game_id,
    "Points" = daily_scores
  ) |>
  mutate(
    team_image = recode(
      Team,
      !!!team_images
    )
  ) |>
  merge(
    data.frame(
      Team = names(team_colours),
      Colours = team_colours
    )
  )

  data |>
    ggplot() +
    geom_line(
      aes(
        x = Game,
        y = Points,
        colour = Colours),
      linewidth = 2
    ) +
    geom_point(
      data = standings,
      aes(
        x = max(data$Game),
        y = Points,
        colour = Colours
      ),
      size = 15
    ) +
    geom_image(
      data = standings,
      aes(
        x = max(data$Game),
        y = Points,
        image = Team
      )
    ) +
    scale_color_identity() +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
    theme_minimal()
}
```

```{r "standings over time preseason"}
#| title: "Pre-season"

if (
  schedule_to_date_preseason |>
  filter(
    game_status %in% c(
      "Final",
      "Final OT"
    )
  ) |>
  nrow() ==
    0
) {
  value_box(
    title = "No data available",
    showcase = bs_icon(
      "hourglass-split",
      size = "6vh"
    ),
    value = tags$p(
      "No games played yet this season",
      style = "font-size: 4vh;"
    ),
    theme = "danger"
  )
} else {

  data <- roster_points_per_game_preseason |> lapply(
    function(x) x |> mutate(
      earliest_game_id = schedule_to_date_preseason$game_id[1]
    ) |>
    expand(
      game_id = as.numeric(schedule_to_date_preseason$game_id),
      earliest_game_id
    ) |> select(
      -earliest_game_id
    ) %>% left_join(
      x,
      by = c(
        "game_id"
      )
    ) |> mutate(
      goals = ifelse(
        is.na(goals),
        0,
        goals
      ),
      assists = ifelse(
        is.na(assists),
        0,
        assists
      ),
      wins = ifelse(
        is.na(wins),
        0,
        wins
      ),
      ot_losses = ifelse(
        is.na(ot_losses),
        0,
        ot_losses
      ),
      wins = 2*wins,
    ) %>%
    mutate(
      fantasy_points = rowSums(
        select(
          .,
          c(
            goals,
            assists,
            wins,
            ot_losses
          )
        )
      )
    ) |>
    arrange(
      game_id
    ) |> select(
      c(
        game_id,
        fantasy_points
      )
    ) |> group_by(
      game_id
    ) |> summarise(
      daily_scores = sum(fantasy_points)
    ) |>
    mutate(
      daily_scores = cumsum(daily_scores),
      game_id = row_number()
    )
  ) |> bind_rows(
    .id = "Team"
  ) |>
  rename(
    "Game" = game_id,
    "Points" = daily_scores
  ) |>
  mutate(
    team_image = recode(
      Team,
      !!!team_images
    )
  ) |>
  merge(
    data.frame(
      Team = names(team_colours),
      Colours = team_colours
    )
  )

  data |>
    ggplot() +
    geom_line(
      aes(
        x = Game,
        y = Points,
        colour = Colours),
      linewidth = 2
    ) +
    geom_point(
      data = standings_preseason,
      aes(
        x = max(data$Game),
        y = Points,
        colour = Colours
      ),
      size = 15
    ) +
    geom_image(
      data = standings_preseason,
      aes(
        x = max(data$Game),
        y = Points,
        image = Team
      )
    ) +
    scale_color_identity() +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
    theme_minimal()
}
```

# Team Rosters

::: {.panel-tabset}

```{r "team rosters"}
#| output: asis
res <- purrr::map_chr(
  unique(names(team_rosters)),
  function(name) {
    knitr::knit_child(
      text = c(
        "## `r name`",
        "",
        "```{r}",
        "#| echo: false",
        "html(",
        "    web_image(",
        "        url = standings |>",
        "          filter(",
        "            Name == name",
        "          ) |>",
        "          select(",
        "            Team",
        "          ) |>",
        "          pull(),",
        "        height = '50px'",
        "    )",
        ")",
        "",
        "generate_pwhl_roster_gt_table(",
        "    name,",
        "    team_rosters,",
        "    fantasy_roster_points",
        ")",
        "",
        "```",
        "",
        ""
      ),
      envir = environment(),
      quiet = TRUE
    )
  }
)

cat(res, sep = '\n')
```
:::

# Team Rosters (Pre-season)

::: {.panel-tabset}

```{r "team rosters preseason"}
#| output: asis
res <- purrr::map_chr(
  unique(names(team_rosters)),
  function(name) {
    knitr::knit_child(
      text = c(
        "## `r name`",
        "",
        "```{r}",
        "#| echo: false",
        "html(",
        "    web_image(",
        "        url = standings |>",
        "          filter(",
        "            Name == name",
        "          ) |>",
        "          select(",
        "            Team",
        "          ) |>",
        "          pull(),",
        "        height = '50px'",
        "    )",
        ")",
        "",
        "generate_pwhl_roster_gt_table(",
        "    name,",
        "    team_rosters_preseason,",
        "    fantasy_roster_points_preseason",
        ")",
        "",
        "```",
        "",
        ""
      ),
      envir = environment(),
      quiet = TRUE
    )
  }
)

cat(res, sep = '\n')
```
:::

# Schedule

## Row {.tabset}

```{r "schedule"}
#| title: "Regular season"

schedule |>
    select(
        c(
            game_date,
            game_status,
            away_team_logo,
            away_score,
            home_team_logo,
            home_score
        )
    ) |>
    mutate(
        game_date = as.Date(
                game_date,
                format="%Y-%m-%d"
            ) |>
            format(
                "%a, %b %e"
            )
    ) |>
    gt() |>
    fmt_image(
        columns = c(
            away_team_logo,
            home_team_logo
        )
    ) |>
    cols_align(
        align = "center",
        columns = c(
            game_status,
            away_score,
            home_score
        )
    ) |>
    cols_width(
        game_date ~ pct(20),
        game_status ~ pct(20),
        away_team_logo ~ pct(10),
        away_score ~ pct(10),
        home_team_logo ~ pct(10),
        home_score ~ pct(10)
    ) |>
    cols_label(
        game_date = "Date",
        game_status = "Time",
        away_team_logo = "Away",
        away_score = "Score",
        home_team_logo = "Home",
        home_score = "Score"
    ) |>
    tab_options(
    table.background.color = "#F5F5F5",
    column_labels.background.color = "#2B2D42",
    table.font.size = px(16),
    table.border.top.color = "transparent",
    table.border.bottom.color = "transparent",
    table_body.hlines.color = "transparent",
    table_body.border.bottom.color = "transparent",
    column_labels.border.bottom.color = "transparent",
    column_labels.border.top.color = "transparent"
  ) |> 
  tab_style_body(
    style = cell_borders(
      sides = c("top", "right", "left", "bottom"),
      weight = px(0) # Remove row borders
    ),
    fn = function(x) { is.numeric(x) | is.character(x) }
  ) |> 
  opt_css(
    css = "

    table tr:nth-child(odd) {
      background-color: #e0dedeff;
    }

    .gt_col_heading {
      position: sticky !important;
      top: 0px !important;
      z-index: 10 !important;
    }
    "
  )
```

```{r "schedule preseason"}
#| title: "Pre-season"

schedule_preseason |>
    select(
        c(
            game_date,
            game_status,
            away_team_logo,
            away_score,
            home_team_logo,
            home_score
        )
    ) |>
    mutate(
        game_date = as.Date(
                game_date,
                format="%Y-%m-%d"
            ) |>
            format(
                "%a, %b %e"
            )
    ) |>
    gt() |>
    fmt_image(
        columns = c(
            away_team_logo,
            home_team_logo
        )
    ) |>
    cols_align(
        align = "center",
        columns = c(
            game_status,
            away_score,
            home_score
        )
    ) |>
    cols_width(
        game_date ~ pct(20),
        game_status ~ pct(20),
        away_team_logo ~ pct(10),
        away_score ~ pct(10),
        home_team_logo ~ pct(10),
        home_score ~ pct(10)
    ) |>
    cols_label(
        game_date = "Date",
        game_status = "Time",
        away_team_logo = "Away",
        away_score = "Score",
        home_team_logo = "Home",
        home_score = "Score"
    ) |>
    tab_options(
    table.background.color = "#F5F5F5",
    column_labels.background.color = "#2B2D42",
    table.font.size = px(16),
    table.border.top.color = "transparent",
    table.border.bottom.color = "transparent",
    table_body.hlines.color = "transparent",
    table_body.border.bottom.color = "transparent",
    column_labels.border.bottom.color = "transparent",
    column_labels.border.top.color = "transparent"
  ) |> 
  tab_style_body(
    style = cell_borders(
      sides = c("top", "right", "left", "bottom"),
      weight = px(0) # Remove row borders
    ),
    fn = function(x) { is.numeric(x) | is.character(x) }
  ) |> 
  opt_css(
    css = "

    table tr:nth-child(odd) {
      background-color: #e0dedeff;
    }

    .gt_col_heading {
      position: sticky !important;
      top: 0px !important;
      z-index: 10 !important;
    }
    "
  )
```


# Team Generator {#team-generator}

Select one of the rows in this table to use (or take some inspo from)

```{r "random team generator"}

seed <- 1

random_teams <- data.frame(matrix(ncol = 12, nrow = 0)) |> set_names("F1", "F2", "F3", "F4", "F5", "F6", "D1", "D2", "D3", "D4", "G1", "G2")

for (i in 1:50) {
  random_team <- all_teams |> mutate(
    position = case_when(
      position == "C" ~ "F",
      position == "LW" ~ "F",
      position == "RW" ~ "F",
      position == "LD" ~ "D",
      position == "RD" ~ "D",
      .default = position
    )
  ) |> 
    group_by(position) |>
    slice_sample(
      n = 6
    ) |> ungroup()

    random_teams <- rbind(
      random_teams,
      rbind(
        random_team |> filter(position == "F") |> select(player_name),
        random_team |> filter(position == "D") |> slice(1:4) |> select(player_name),
        random_team |> filter(position == "G") |> slice(1:2) |> select(player_name)
      ) |> transpose() |> set_names(
        "F1", "F2", "F3", "F4", "F5", "F6", "D1", "D2", "D3", "D4", "G1", "G2"
      )
    )
  
}

random_teams <- cbind(
  Team_name = slice_sample(read.csv("static/common_words.csv"), n = 50),
  Team_colour = sample(rgb(
  t(col2rgb(colors())),
  maxColorValue = 255
), 50), random_teams
)

library(DT)

random_teams |> datatable()

```

# Draft Info

## Row

::: {.card title="Rules"}
Choose your fantasy team name, colour, logo and roster in the [Google Sheet](https://docs.google.com/spreadsheets/d/1sywjZ6quCmbLBq_wEEXZEDzcW0NeBpCtRaT3W1hDkhI/edit?usp=sharing). (If you want some inspiration for your draft, you can check out the [team generator](#team-generator))<br>
&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”´ğŸŸ¡ğŸ”µ**Team Colour:** Valid hexadecimal colour code<br>
&nbsp;&nbsp;&nbsp;&nbsp;ğŸ‘©â€ğŸ‘©â€ğŸ‘§ğŸ“·ğŸ–¥ï¸**Team Image:** Valid link to any image on the web<br><br>
Your team should have exactly the following (the Google Sheet dropdowns force this structure, don't worry!):<br>
&nbsp;&nbsp;&nbsp;&nbsp;**ğŸ’ 6 forwards**<br>
&nbsp;&nbsp;&nbsp;&nbsp;**ğŸ›¡ï¸ 4 defenders**<br>
&nbsp;&nbsp;&nbsp;&nbsp;**ğŸ¥… 2 goalies**<br><br>
ğŸ˜®â€ğŸ’¨ Players/goalies aren't restricted to a single fantasy team so if someone took a player you like, you can take them too!<br><br>
â†”ï¸ **Trades:** Throughout the season, you are allowed **exactly 1 trade** (respecting the team structure). Your new player only contributes points to your fantasy score starting the day after the trade. Please **let Alex or Noah know directly** if/when you make a trade!<br><br>
ğŸ• **Deadline:** You can use all of November's pre-season and regular season games to scout your roster and aim to lock it in by **November 30th, 2025**! After this date, the Google Sheet will be ğŸ‘ï¸**View Only**ğŸ‘ï¸<br><br>
ğŸ’°ğŸ’µğŸ’¸ **Prize pool (Optional):** E-transfer $10 to Alex or Noah to enter in the fantasy prize pool! More information TBD but you could **WIN BIGGGG! (Send an e-transfer or intent to e-transfer by the roster deadline to enter the prize pool)**
:::

## Row

::: {.card title="Scoring"}
Your fantasy team's score is updated daily with data from the previous day's games. Each day, each member of your fantasy roster will contribute a number of points to your team's overall score, following the scheme below:

ğŸ’ 1 point per goal<br>
ğŸ¤ 1 point per assist<br>
âœ¨ 2 points per win\*<br>
ğŸ˜– 0 points per loss\*<br>
ğŸ¥‡ 1 point per OT loss\*

You can check how your and everyone else's teams are doing [here](#team-standings). Note that eventually, only **regular season games** will contribute to your fantasy teams score.

\*Note that if your play did not play in a game in which their team won, they will *not* contribute points to your score (this includes dressed goalies that did not get subbed in).
:::